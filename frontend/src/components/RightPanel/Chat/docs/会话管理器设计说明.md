# ChatSessionManager 会话管理器设计说明

## 概述

ChatSessionManager 组件负责管理 HearSight 应用中的聊天会话，提供会话的创建、查看、重命名和删除功能。该组件是聊天功能的核心管理模块，确保用户可以方便地组织和管理多个聊天会话。

## 组件结构

### ChatSessionManager.tsx

主容器组件，负责：

- 会话列表的加载和展示
- 会话的创建、选择、删除和重命名操作
- 用户交互事件的处理
- 与后端 API 的通信

### 核心功能模块

- **会话列表管理**: 加载和展示所有聊天会话
- **会话创建**: 创建新的聊天会话
- **会话选择**: 选择并切换到指定会话
- **会话重命名**: 修改会话标题
- **会话删除**: 删除不需要的会话

## 设计原则

### 1. 用户友好性
- 提供直观的会话管理界面
- 支持会话的增删改查操作
- 显示会话的创建和更新时间
- 提供操作反馈和错误提示

### 2. 数据一致性
- 与后端保持数据同步
- 实时更新会话列表
- 处理网络请求错误
- 提供加载状态指示

### 3. 状态管理
- 本地状态管理会话列表
- 管理编辑和删除操作的状态
- 缓存用户操作结果

## 功能详解

### 会话列表加载

- 组件挂载时自动加载会话列表
- 通过 getChatSessions API 获取数据
- 处理加载错误并显示提示信息
- 使用 toast 显示操作结果

### 会话创建

- 点击"新建会话"按钮创建新会话
- 调用 createChatSession API 创建会话
- 创建成功后自动选择新会话
- 更新本地会话列表

### 会话选择

- 点击会话项切换到指定会话
- 通过 onSessionSelect 回调通知父组件
- 高亮显示当前选中的会话
- 支持键盘导航操作

### 会话重命名

- 点击会话项的编辑按钮打开重命名对话框
- 输入新标题并保存
- 调用 updateChatSessionTitle API 更新标题
- 更新本地会话列表状态

### 会话删除

- 点击会话项的删除按钮打开确认对话框
- 确认后调用 deleteChatSession API 删除会话
- 删除成功后从本地列表中移除
- 如果删除的是当前会话，通知父组件

## 数据流设计

### Props 接口

- currentSessionId: 当前选中的会话ID
- onSessionSelect: 会话选择回调
- onSessionCreate: 会话创建回调
- onSessionDelete: 会话删除回调

### 内部状态

- sessions: 会话列表状态
- loading: 加载状态
- editingSession: 编辑中的会话状态
- editTitle: 编辑标题状态
- deleteDialogOpen: 删除确认对话框状态
- sessionToDelete: 待删除会话状态

### 会话数据结构

- id: 会话ID
- title: 会话标题
- created_at: 创建时间
- updated_at: 更新时间

## 用户交互设计

### 会话列表展示

- 使用卡片式布局展示会话项
- 显示会话标题和时间信息
- 当前选中会话高亮显示
- 支持滚动查看所有会话

### 操作按钮

- **新建会话按钮**: 位于列表顶部，点击创建新会话
- **编辑按钮**: 每个会话项右侧，点击打开重命名对话框
- **删除按钮**: 每个会话项右侧，点击打开删除确认对话框

### 对话框设计

- **重命名对话框**: 包含输入框和确认/取消按钮
- **删除确认对话框**: 显示确认信息和确认/取消按钮

## 错误处理

### 网络错误处理
- API 请求失败时显示 toast 错误提示
- 记录错误日志便于调试
- 保持界面响应性

### 用户操作处理
- 表单验证确保输入有效性
- 删除操作前进行二次确认
- 操作成功后提供反馈信息

## 无障碍设计

### 键盘导航
- 支持 Tab 键在元素间导航
- 支持 Enter 键激活按钮
- 支持方向键选择会话项

### 屏幕阅读器支持
- 提供适当的 ARIA 标签
- 为操作按钮添加描述性文本
- 确保界面元素语义化